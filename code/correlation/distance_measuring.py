import os
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt
from sklearn.metrics.pairwise import euclidean_distances

# Set the path to the folder containing the CSV files
input_folder = '../../countrywise_dataset'

# Set the path to the folder where you want to save the heatmaps
output_folder = '../../results/distance_matrix'

# Create the output folder if it doesn't exist
if not os.path.exists(output_folder):
    os.makedirs(output_folder)

# Define the columns to use for calculating distance
columns_to_use = [
    ('Cardiovascular diseases', 'Cardiovascular diseases'),
    ('Lower respiratory infections', 'Lower respiratory infections'),
    ('Neonatal disorders', 'Neonatal disorders'),
    ('Environmental heat and cold exposure', 'Environmental heat and cold exposure'),
    ('Diabetes mellitus', 'Diabetes mellitus'),
    ('Chronic kidney disease', 'Chronic kidney disease'),
    ('Chronic respiratory diseases', 'Chronic respiratory diseases'),
    ('CO (Carbon Monoxide)', 'CO'),
    ('NMVOC (Non metallic volatile organic component)', 'NMVOC'),
    ('NOX (Nitrogen Oxides)', 'NOX'),
    ('PM10 (Particulate matter 10)', 'PM10'),
    ('PM2-5 (Particulate matter 2-5)', 'PM2-5'),
    ('SOX (Sulphur Oxides)', 'SOX')
]

# Get a list of CSV files in the input folder
csv_files = [file for file in os.listdir(input_folder) if file.endswith('.csv')]

# Loop through each CSV file
for file_name in csv_files:
    # Read the CSV file into a DataFrame
    file_path = os.path.join(input_folder, file_name)
    df = pd.read_csv(file_path)
    
    # Extract the required columns
    data = df[[col[1] for col in columns_to_use]].values

    # Calculate Euclidean distance matrix
    distance_matrix = euclidean_distances(data.T, data.T)

    # Create a heatmap
    plt.figure(figsize=(35,35))
    sns.heatmap(distance_matrix, annot=True, fmt=".2f", annot_kws={"size": 24},cmap="viridis", xticklabels=[col[0] for col in columns_to_use], yticklabels=[col[0] for col in columns_to_use])
    plt.title("Euclidean Distance Heatmap")
    plt.xlabel("Features")
    plt.ylabel("Features")
    
    # Save the heatmap as an image
    output_file_path = os.path.join(output_folder, f"{file_name.split('.')[0]}_heatmap.png")
    plt.savefig(output_file_path)
    plt.close()

print("Heatmaps saved successfully.")
