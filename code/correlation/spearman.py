import os
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

# Path to the folder containing CSV files
folder_path = '../../countrywise_dataset'

# Path to the folder to save the heatmap images
output_folder_path = '../../results/spearman_results'

# Columns to use for correlation calculation
columns = [
    ('Cardiovascular diseases', 'Cardiovascular diseases'),
    ('Lower respiratory infections', 'Lower respiratory infections'),
    ('Neonatal disorders', 'Neonatal disorders'),
    ('Environmental heat and cold exposure', 'Environmental heat and cold exposure'),
    ('Diabetes mellitus', 'Diabetes mellitus'),
    ('Chronic kidney disease', 'Chronic kidney disease'),
    ('Chronic respiratory diseases', 'Chronic respiratory diseases'),
    ('CO (Carbon Monoxide)', 'CO'),
    ('NMVOC (Non metallic volatile organic component)', 'NMVOC'),
    ('NOX (Nitrogen Oxides)', 'NOX'),
    ('PM10 (Particulate matter 10)', 'PM10'),
    ('PM2-5 (Particulate matter 2-5)', 'PM2-5'),
    ('SOX (Sulphur Oxides)', 'SOX')
]

# Create the output folder if it doesn't exist
if not os.path.exists(output_folder_path):
    os.makedirs(output_folder_path)

# Function to calculate correlation coefficient and generate heatmap
def generate_heatmap(csv_file, method='spearman'):
    # Read the CSV file
    data = pd.read_csv(csv_file)
    # Extract required columns
    data = data[[col[1] for col in columns]]
    # Calculate correlation matrix
    correlation_matrix = data.corr(method=method)
    # Generate heatmap
    plt.figure(figsize=(35, 35))
    sns.heatmap(correlation_matrix, annot=True, cmap='coolwarm', fmt=".2f", annot_kws={"size": 24})
    plt.title(f'{method.capitalize()} Correlation Coefficients for {os.path.basename(csv_file)}', fontsize=24)
    # Save the heatmap image
    output_file = os.path.join(output_folder_path, f'heatmap_{os.path.basename(csv_file).split(".")[0]}_{method}.png')
    plt.savefig(output_file)
    plt.close()

# Iterate through all CSV files in the folder
for file_name in os.listdir(folder_path):
    if file_name.endswith('.csv'):
        csv_file_path = os.path.join(folder_path, file_name)
        generate_heatmap(csv_file_path, method='spearman')
