import pandas as pd
import matplotlib.pyplot as plt
from statsmodels.graphics.tsaplots import plot_acf, plot_pacf
import os

# Read the pollutants.csv file
pollutants_data = pd.read_csv("./common_pollutants.csv")

# Create a directory to store plots
if not os.path.exists("acf_pcf_plots"):
    os.makedirs("acf_pcf_plots")

# Iterate over each row in pollutants data
for index, row in pollutants_data.iterrows():
    country = row["Country"]
    disease = row["Disease"]
    pollutant = row["Pollutant"]
    
    # Create directory for country if it doesn't exist
    country_directory = os.path.join("acf_pcf_plots", country)
    if not os.path.exists(country_directory):
        os.makedirs(country_directory)
    
    # Load the time-series data for the country
    time_series_file = os.path.join("../../countrywise_dataset", f"{country}.csv")
    time_series_data = pd.read_csv(time_series_file)
    
    # Plot ACF for disease
    fig, ax = plt.subplots(figsize=(10, 5))
    plot_acf(time_series_data[disease], ax=ax, title=f"ACF - {disease}")
    plt.savefig(os.path.join(country_directory, f"ACF_{disease}.png"))
    plt.close()
    
    # Plot PACF for disease
    fig, ax = plt.subplots(figsize=(10, 5))
    plot_pacf(time_series_data[disease], ax=ax, title=f"PACF - {disease}")
    plt.savefig(os.path.join(country_directory, f"PACF_{disease}.png"))
    plt.close()
    
    # Plot ACF for pollutant
    fig, ax = plt.subplots(figsize=(10, 5))
    plot_acf(time_series_data[pollutant], ax=ax, title=f"ACF - {pollutant}")
    plt.savefig(os.path.join(country_directory, f"ACF_{pollutant}.png"))
    plt.close()
    
    # Plot PACF for pollutant
    fig, ax = plt.subplots(figsize=(10, 5))
    plot_pacf(time_series_data[pollutant], ax=ax, title=f"PACF - {pollutant}")
    plt.savefig(os.path.join(country_directory, f"PACF_{pollutant}.png"))
    plt.close()